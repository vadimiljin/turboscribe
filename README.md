# TurboScribe

Система автоматической транскрипции и атрибуции спикеров для Zoom-встреч Product Review.

## Описание

TurboScribe обрабатывает записи Zoom-встреч, объединяя данные из двух источников:
- **Zoom VTT файлы** — содержат имена спикеров и временные метки, но текст часто поврежден
- **TurboScribe VTT файлы** — содержат качественный текст транскрипции, но без атрибуции спикеров

Система автоматически выравнивает эти файлы, используя временные метки и LLM для разрешения неоднозначных случаев, создавая финальные транскрипты с правильно определенными спикерами.

## Структура проекта

```
turboscribe/
├── align_vtt_vtt_llm.py      # Основной скрипт выравнивания VTT файлов
├── recordings.csv              # Список Zoom записей (URL, пароли)
├── emails.csv                 # База данных участников (имена, варианты, роли)
├── requirements.txt           # Python зависимости
├── Product_Review_2025/      # Обработанные транскрипты встреч
│   └── [номер]-[название]/
│       ├── [номер]-[название]-transcript.md    # Финальный транскрипт
│       ├── [номер]-[название]-transcript.jsonl  # JSON Lines формат
│       └── [номер]-[название]-transcript.vtt   # VTT формат
└── README.md                  # Этот файл
```

## Как это работает

### 1. Подготовка данных

**recordings.csv** — содержит информацию о Zoom записях:
```csv
"Directory","URL","Password"
"Product_Review_2025/47-product-review-19-nov","https://zoom.us/rec/share/...","password"
```

**emails.csv** — база данных участников с вариантами написания имен:
```csv
"Email","Full Name","Полное имя","Name Variants","Role"
"alexs@route4me.com","Alex Shulga","Алекс Шульга","Alex Shulha; Alexey Shulga","QA"
```

### 2. Процесс выравнивания

Скрипт `align_vtt_vtt_llm.py` выполняет следующие шаги:

1. **Парсинг файлов**
   - Читает Zoom VTT (имена спикеров + временные метки)
   - Читает TurboScribe VTT (качественный текст + временные метки)

2. **Временное сопоставление**
   - Находит сегменты текста, которые перекрываются по времени с сегментами спикеров
   - Вычисляет степень перекрытия для каждого кандидата

3. **Классификация уверенности**
   - **Высокая уверенность** — один четкий кандидат с большим перекрытием → прямое назначение
   - **Неоднозначные случаи** — несколько кандидатов или низкое перекрытие → отправка в LLM

4. **LLM разрешение неоднозначностей**
   - Для неоднозначных случаев отправляет контекст в OpenAI API
   - LLM анализирует текст, временные метки и список кандидатов
   - Возвращает решение с обоснованием

5. **Генерация результатов**
   - Создает Markdown транскрипт с форматированием
   - Создает JSON Lines файл для программной обработки
   - Создает VTT файл для совместимости

### 3. Формат выходных файлов

**Markdown транскрипт** (`*-transcript.md`):
```markdown
**Serhii Kasainov** [00:00:00 - 00:00:23]: Это покажем. Вроде выглядит все клево...

**Dmitry Smaliak** [00:00:23 - 00:00:40]: Нет, по DestinationDriver я пока еще не смотрел...
```

**JSON Lines** (`*-transcript.jsonl`):
```json
{"start": 0, "end": 23.0, "speaker": "Serhii Kasainov", "text": "Это покажем...", "confidence": 0.95}
{"start": 23, "end": 40.0, "speaker": "Dmitry Smaliak", "text": "Нет, по DestinationDriver...", "confidence": 0.98}
```

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/vadimiljin/turboscribe.git
cd turboscribe
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` с вашим OpenAI API ключом:
```bash
echo "OPENAI_API_KEY=your-api-key-here" > .env
```

## Использование

### Базовое использование

```bash
python align_vtt_vtt_llm.py "Product_Review_2025/47-product-review-19-nov"
```

### С подробным выводом

```bash
python align_vtt_vtt_llm.py "Product_Review_2025/47-product-review-19-nov" --verbose
```

### Параметры

- `<folder_path>` — путь к директории с VTT файлами
- `--verbose` — включить подробный вывод процесса обработки

## Требования к файлам

В директории встречи должны находиться:

1. **Zoom VTT файл** — обычно называется `zoom.vtt` или `GMT*.vtt`
   - Должен содержать имена спикеров в формате `SPEAKER_NAME: текст`
   - Должен содержать временные метки в формате `HH:MM:SS.mmm --> HH:MM:SS.mmm`

2. **TurboScribe VTT файл** — обычно называется `*transcript.vtt` или `*Recording.transcript.vtt`
   - Должен содержать качественный текст транскрипции
   - Должен содержать временные метки

## База данных участников

Файл `emails.csv` содержит информацию о всех участниках:

- **Email** — уникальный идентификатор (primary key)
- **Full Name** — основное имя на английском
- **Полное имя** — русская/украинская транскрипция
- **Name Variants** — варианты написания через точку с запятой (например: "Alex Shulha; Alexey Shulga")
- **Role** — роль в команде

При обнаружении новых имен или вариантов написания, обновите `emails.csv`.

## Особенности

- **Автоматическое разрешение неоднозначностей** — LLM помогает в сложных случаях
- **Логирование решений** — все решения LLM сохраняются с обоснованием
- **Обработка вариантов имен** — система распознает разные написания одного имени
- **Высокая точность** — комбинация временного сопоставления и LLM дает точность ~94-95%

## Формат выходных данных

### Статистика встречи

Каждый транскрипт начинается с метаданных:
- Дата и время встречи
- Длительность
- Количество участников
- Общая точность атрибуции

### Сегменты транскрипта

Каждый сегмент содержит:
- Имя спикера (из базы данных участников)
- Временные метки начала и конца
- Текст высказывания
- Уровень уверенности (для JSON формата)

## Разработка

### Добавление новых участников

1. Откройте `emails.csv`
2. Добавьте новую строку с email, именем, транскрипцией и ролью
3. Если есть варианты написания, добавьте их в колонку "Name Variants"

### Обработка новых встреч

1. Добавьте запись в `recordings.csv` с URL и паролем
2. Скачайте Zoom VTT файл
3. Получите TurboScribe VTT файл
4. Поместите оба файла в директорию встречи
5. Запустите скрипт выравнивания

## Лицензия

Внутренний проект Route4Me.

## Автор

Vadim Iljin (@vadimiljin)
