# Changelog: Name Disambiguation v2

## Что изменилось

### ✅ УДАЛЕНО: employees.json

**Причина**: избыточный файл, дублирует данные из emails.csv

### ✅ Единственный источник правды: emails.csv

Все данные о людях теперь берутся **только** из `emails.csv`:
- Email (уникальный ID)
- Full Name (английское имя для ссылок)
- RU/UA Transcription (русское имя для текста)

### ✅ Автоматическая генерация вариантов имен

Система теперь **автоматически** генерирует:

#### 1. Все падежи русских имен
```
Владимир → Владимира, Владимиру, Владимиром, Владимире
Федоров → Федорова, Федорову, Федоровым, Федорове
Ольга → Ольги, Ольге, Ольгу, Ольгой
```

#### 2. Уменьшительные формы
```
Александр → Саша, Саня, Шура, Алекс, Саньок
Владимир → Вова, Володя, Вовка, Вован
Ольга → Оля
Максим → Макс
Дмитрий → Дима, Митя
```

#### 3. Падежи уменьшительных
```
Саша → Саши, Саше, Сашу, Сашей
Вова → Вовы, Вове, Вову, Вовой
```

#### 4. Английские варианты
```
Alexander → Alex, Sasha
Vladimir → Vova
Maksym → Max
```

**Результат**: ~50+ вариантов для каждого человека!

## Новые методы

### `generate_name_variants()`

Автоматически генерирует все варианты имен из `emails.csv`.

**Вывод:**
```
[OK] Сгенерировано 487 вариантов имен
[INFO] Неоднозначных вариантов: 12
[INFO] Примеры конфликтов:
   - 'Владимир': Vladimir Fedorov, Vladimir Zhakhavets
   - 'Вова': Vladimir Fedorov, Vladimir Zhakhavets
```

### `_generate_case_variants(name)`

Генерирует все падежи для русского имени/фамилии:
- Мужские имена на согласную: Артур → Артура, Артуру, Артуром
- Мужские на -й: Евгений → Евгения, Евгению, Евгением
- Мужские на -ь: Игорь → Игоря, Игорю, Игорем
- Женские на -а: Ольга → Ольги, Ольге, Ольгу, Ольгой
- Фамилии на -ов/-ев/-ин: Федоров → Федорова, Федорову, Федоровым
- Фамилии на -ский: Скрыньковский → Скрыньковского, Скрыньковскому

### `resolve_name_disambiguation()`

Обновлен для работы с автоматически сгенерированными вариантами.
Использует `name_variant_to_emails` вместо `employees_db`.

## Словари

### `DIMINUTIVE_NAMES`

Словарь уменьшительных форм имен:

```python
DIMINUTIVE_NAMES = {
    # Русские
    'Александр': ['Саша', 'Саня', 'Шура', 'Алекс', 'Саньок'],
    'Владимир': ['Вова', 'Володя', 'Вовка', 'Вован'],
    'Евгений': ['Женя'],
    'Максим': ['Макс'],
    'Ольга': ['Оля'],
    'Дмитрий': ['Дима', 'Митя'],
    # ... и т.д.
    
    # Английские
    'Alexander': ['Alex', 'Sasha'],
    'Vladimir': ['Vova'],
    # ... и т.д.
}
```

### `TRANSLITERATION_ALIASES`

Специальные случаи транслитерации:

```python
TRANSLITERATION_ALIASES = {
    'Ден': 'Дэн',
    'Дан': 'Дэн',
    'Den': 'Dan',
    'Семен': 'Семён',
}
```

## Преимущества

### ✅ Простота
- Один файл (`emails.csv`) вместо двух
- Не нужно вручную создавать варианты имен

### ✅ Полнота
- Автоматически генерируются ВСЕ падежи
- Автоматически генерируются падежи уменьшительных
- ~50+ вариантов на человека

### ✅ Точность
- Правила склонения русского языка
- Учет окончаний (-ов, -ев, -ин, -ский)

### ✅ Расширяемость
- Легко добавить новое уменьшительное имя
- Легко добавить новое правило склонения

## Миграция

### Было (с employees.json)
```python
# Нужно было вручную создавать файл
{
  "employees": [
    {
      "email": "vladimirfedorov@route4me.com",
      "variants": ["Владимир", "Владимира", "Владимиру", ...] # Вручную!
    }
  ]
}
```

### Стало (только emails.csv)
```csv
Email,Full Name,RU/UA Transcription
vladimirfedorov@route4me.com,Vladimir Fedorov,Владимир Федоров
```

Система сама сгенерирует: Владимир, Владимира, Владимиру, Владимиром, Вова, Вовы, Володя, и т.д.

## Тестирование

```bash
python standardize_product_reviews.py --test
```

**Ожидаемый вывод:**
```
[OK] Загружено 37 email из emails.csv
[OK] Сгенерировано 487 вариантов имен
[INFO] Неоднозначных вариантов: 12
[INFO] Примеры конфликтов:
   - 'Владимир': Vladimir Fedorov, Vladimir Zhakhavets
   - 'Вова': Vladimir Fedorov, Vladimir Zhakhavets

[DISAMB] Проверка неоднозначных имен (Владимир, Игорь, и т.д.)...

[DISAMB] Разрешение для 'Владимир' (2 кандидатов, 5 упоминаний)...
[LLM] Уверенность: 85%
   - Упоминание 'между снэпшотами' указывает на зону ответственности Vladimir Fedorov
[OK] 'Владимир' → Vladimir Fedorov (vladimirfedorov@route4me.com)

[OK] Разрешено 1 конфликтов имен
```

## Что делать дальше

1. **Проверьте emails.csv** - убедитесь, что все люди в базе
2. **Добавьте уменьшительные** - если нужны новые варианты, добавьте в `DIMINUTIVE_NAMES`
3. **Запустите тест** - проверьте, что всё работает
4. **Обработайте документы** - запустите на всех файлах

## Обратная совместимость

✅ Все существующие документы будут работать как раньше
✅ Улучшилась точность разрешения конфликтов
✅ Добавилась поддержка всех падежей автоматически

## Вопросы?

См. `NAME_DISAMBIGUATION_README.md` для полной документации.

