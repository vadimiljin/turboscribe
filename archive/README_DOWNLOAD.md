# Автоматическое скачивание Zoom записей

## Быстрый старт

### Шаг 1: Установка зависимостей

```bash
pip install -r requirements.txt
playwright install chromium
```

### Шаг 2: (Опционально) Очистка CSV

Если в CSV есть дублированные URL (с markdown ссылками), очистите их:

```bash
python fix_csv.py
```

Это создаст `recordings_clean.csv`. Затем можно использовать его вместо `recordings.csv`.

### Шаг 3: Запуск

**Вариант 1: Playwright (Рекомендуется) ⭐**
```bash
python download_recordings.py
```

**Вариант 2: Selenium**
```bash
python download_recordings_selenium.py
```

---

## Детальное описание вариантов

### Вариант 1: Playwright (Рекомендуется) ⭐

**Преимущества:**
- ✅ Быстрый и надежный
- ✅ Хорошая поддержка ожиданий элементов
- ✅ Можно запускать параллельно несколько загрузок (по умолчанию 2)
- ✅ Поддержка headless режима
- ✅ Автоматическая распаковка ZIP архивов

**Установка:**
```bash
pip install playwright
playwright install chromium
```

**Запуск:**
```bash
python download_recordings.py
```

**Настройки в коде:**
- `max_concurrent=2` - количество параллельных загрузок (можно увеличить до 3-5)
- `headless=False` - показывать браузер (для отладки). Для production можно `True`
- `TIMEOUT = 60000` - таймаут загрузки страниц (60 сек)
- `DOWNLOAD_TIMEOUT = 300000` - таймаут скачивания файлов (5 минут)

**Что делает скрипт:**
1. Читает `recordings.csv`
2. Для каждой записи:
   - Открывает URL в браузере
   - Вводит пароль
   - Нажимает "Watch Recording"
   - Ищет ссылку "Download (3 files)" или "Download"
   - Скачивает три отдельных файла: `.vtt`, `.mp4` (видео), `.mp4` (аудио)
   - Автоматически переименовывает файлы на основе slug директории
3. Сохраняет логи в `download_recordings.log`

---

### Вариант 2: Selenium

**Преимущества:**
- ✅ Популярная библиотека, много примеров
- ✅ Проще для начинающих

**Недостатки:**
- ❌ Медленнее Playwright
- ❌ Больше потребление ресурсов
- ❌ Последовательная обработка (не параллельно)

**Установка:**
```bash
pip install selenium
# ChromeDriver обычно устанавливается автоматически
```

**Запуск:**
```bash
python download_recordings_selenium.py
```

---

## Важные замечания

### 1. Формат файлов от Zoom

Zoom дает **три отдельных файла** (не ZIP):
- `GMT20251016-132836_Recording.transcript.vtt` - субтитры
- `GMT20251016-132836_Recording_2560x1440.mp4` - полное видео (высокое разрешение)
- `GMT20251016-132836_Recording.mp4` - аудио или видео низкого разрешения

**Скрипт автоматически переименовывает** файлы на основе директории:
- Директория: `Product_Review_2025/40. Product Review 23 Oct`
- Результат в директории:
  - `40-product-review-23-oct-transcript.vtt`
  - `40-product-review-23-oct-video.mp4`
  - `40-product-review-23-oct-audio.mp4`

### 2. Очистка CSV

В вашем `recordings.csv` есть дублированные URL в формате markdown:
```
https://route4me.zoom.us/rec/share/...](https://route4me.zoom.us/rec/share/...
```

Скрипты автоматически очищают такие URL, но можно предварительно почистить:
```bash
python fix_csv.py
```

### 3. Пароли

Некоторые пароли содержат специальные символы (`$`, `&`, `@`, `#`, `%`, `^`, `*`, `?`, `!`). Скрипты корректно их обрабатывают.

### 4. Таймауты

Если загрузка медленная или интернет нестабильный:
- Увеличьте `TIMEOUT` и `DOWNLOAD_TIMEOUT` в скрипте
- Уменьшите `max_concurrent` (меньше параллельных загрузок)

### 5. Структура директорий

Файлы сохраняются в директории, указанной в колонке `Dir` CSV, и **автоматически переименовываются**:

```
Product_Review_2025/40. Product Review 23 Oct/
  ├── 40-product-review-23-oct-transcript.vtt
  ├── 40-product-review-23-oct-video.mp4
  └── 40-product-review-23-oct-audio.mp4
```

Slug формируется из имени директории:
- `40. Product Review 23 Oct` → `40-product-review-23-oct`
- `2. Product Review 16 May` → `2-product-review-16-may`
- `33. Product Review 24 Sept Ad Hoc` → `33-product-review-24-sept-ad-hoc`

---

## Отладка

### Проблемы и решения

**1. Не находит ссылку "Download"**
- Установите `headless=False` чтобы видеть что происходит
- Проверьте скриншот в `[директория]/debug_screenshot.png`
- Возможно, нужно подождать дольше - увеличьте таймауты

**2. Ошибка при вводе пароля**
- Проверьте что пароль правильный в CSV
- Убедитесь что поле для пароля найдено (проверьте селекторы)

**3. Файлы не скачиваются**
- Проверьте права на запись в директориях
- Убедитесь что достаточно места на диске
- Проверьте логи в `download_recordings.log`

**4. ZIP архив не распаковывается**
- ~~Эта проблема больше не актуальна - Zoom дает отдельные файлы, не ZIP~~

**4. Файлы переименованы неправильно**
- Проверьте логи - там показано какие файлы получены от Zoom
- Проверьте slug: например, `40. Product Review 23 Oct` → `40-product-review-23-oct`

### Логи

Все действия записываются в:
- `download_recordings.log` (для Playwright)
- `download_recordings_selenium.log` (для Selenium)

Логи содержат:
- Время выполнения каждого шага
- Ошибки с полным traceback
- Статистику успешных/неудачных загрузок

---

## Рекомендация

**Начните с Playwright варианта** - он более современный, быстрый и надежный. 

Если возникнут проблемы:
1. Проверьте логи
2. Запустите с `headless=False` для визуальной отладки
3. Попробуйте обработать одну запись вручную, чтобы понять структуру страницы
4. Если Playwright не работает, попробуйте Selenium вариант

---

## Пример использования

```bash
# 1. Установка
pip install playwright
playwright install chromium

# 2. (Опционально) Очистка CSV
python fix_csv.py

# 3. Запуск (обработает все 25 записей)
python download_recordings.py

# Или для теста - обработать только одну запись:
# Отредактируйте recordings.csv, оставьте только одну строку
```

---

## Производительность

- **Playwright**: ~2-3 минуты на запись (при max_concurrent=2)
- **Selenium**: ~3-5 минут на запись (последовательно)

Для 25 записей:
- Playwright: ~30-40 минут
- Selenium: ~75-125 минут

